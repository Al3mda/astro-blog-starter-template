---
import { getLocale } from "astro-i18n-aut";

const rawLocale = (getLocale(Astro.url) || "en-US").toLowerCase();

// Remove any leading locale segment (ar | ar-sa | en | en-us) from the pathname
const stripped = Astro.url.pathname.replace(/^\/(ar|ar-sa|en|en-us)(?=\/|$)/i, "");

const withTrailingSlash = (p: string) => {
  if (!p || p === "/") return "/";
  return p.endsWith("/") ? p : p + "/";
};

const base = withTrailingSlash(stripped);

// English is default without a prefix, Arabic is under /ar/
const enLink = base;
const arLink = `/ar${base}`;

const isEn = rawLocale.startsWith("en");
const isAr = rawLocale.startsWith("ar");
---
<div class="language-switcher">
  {isEn ? (
    <>
      <span class="active">English</span>
      <a href={arLink}>العربية</a>
    </>
  ) : (
    <>
      <a href={enLink}>English</a>
      <span class="active">العربية</span>
    </>
  )}
</div>

<style>
  .language-switcher {
    display: flex;
    gap: 1rem;
    align-items: center;
  }

  .language-switcher a {
    color: var(--text-color);
    text-decoration: none;
    opacity: 0.7;
    transition: opacity 0.2s;
  }

  .language-switcher a:hover {
    opacity: 1;
  }

  .language-switcher .active {
    font-weight: 600;
    opacity: 1;
  }
</style>
