---
import { getLocale } from "astro-i18n-aut";

const locale = getLocale(Astro.url) || "en";

// Remove any leading locale segment from the pathname
const stripped = Astro.url.pathname.replace(/^\/(ar|en)(?=\/|$)/i, "");

const withTrailingSlash = (p: string) => {
  if (!p || p === "/") return "/";
  return p.endsWith("/") ? p : p + "/";
};

const base = withTrailingSlash(stripped);

// English is default without a prefix, Arabic is under /ar/
const enLink = base;
const arLink = `/ar${base}`;

const isEn = locale === "en";
const isAr = locale === "ar";
---

<div class="language-switcher">
  {isEn ? (
    <>
      <span class="active">EN</span>
      <a href={arLink}>ع</a>
    </>
  ) : (
    <>
      <a href={enLink}>EN</a>
      <span class="active">ع</span>
    </>
  )}
</div>

<style>
  .language-switcher {
    display: flex;
    gap: 0.5rem;
    align-items: center;
    background: rgba(255, 182, 47, 0.1);
    padding: 0.2rem;
    border-radius: 8px;
    border: 1px solid rgba(255, 182, 47, 0.2);
  }

  .language-switcher a {
    color: #fff;
    text-decoration: none;
    opacity: 0.6;
    transition: all 0.3s ease;
    padding: 0.25rem 0.75rem;
    border-radius: 6px;
    font-size: 0.875rem;
    font-weight: 500;
  }

  .language-switcher a:hover {
    opacity: 1;
    background: rgba(255, 182, 47, 0.2);
  }

  .language-switcher .active {
    font-weight: 600;
    opacity: 1;
    background: #FFB62F;
    color: #180C39;
    padding: 0.25rem 0.75rem;
    border-radius: 6px;
  }
</style>
