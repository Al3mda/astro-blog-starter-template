---
// src/components/meachat/Header.astro
// Main navigation header with i18n support

import { getLocale } from "astro-i18n-aut";
import { getTranslation, isRTL } from '../../i18n/meachat.ts';
import Button from '../ui/Button.astro';
import logoLight from '../../assets/img/logo/MeaChat-Light.svg';
import LanguageSwitcher from '../LanguageSwitcher.astro';

const locale = getLocale(Astro.url) || 'en';
const t = getTranslation(locale);
const rtl = isRTL(locale);
const homeHref = locale === 'ar' ? '/ar/' : '/';
---

<header class="fixed top-0 left-0 right-0 z-40 bg-[#180C39] bg-opacity-90 backdrop-blur-sm">
  <div class="container mx-auto px-4 py-4 flex items-center justify-between">
    
    <!-- Logo -->
    <a href={homeHref} class="flex items-center">
      <img 
        src={logoLight.src} 
        alt="MeaChat Logo" 
        width="200" 
        height="50" 
        class="object-contain"
        style="height:auto; max-width:200px;"
      />
    </a>
    
    <!-- Desktop Navigation -->
    <nav class="hidden md:flex items-center space-x-8 rtl:space-x-reverse">
      <a href={homeHref} class="text-white hover:text-[#FFB62F] transition-colors">
        {t.nav.home}
      </a>
      <a href="#features" class="text-white hover:text-[#FFB62F] transition-colors">
        {t.nav.features}
      </a>
      <a href="#channels" class="text-white hover:text-[#FFB62F] transition-colors">
        {t.nav.channels}
      </a>
      <a href="#integrations" class="text-white hover:text-[#FFB62F] transition-colors">
        {t.nav.integrations}
      </a>
      <a href="#pricing" class="text-white hover:text-[#FFB62F] transition-colors">
        {t.nav.pricing}
      </a>
      <a href="#faq" class="text-white hover:text-[#FFB62F] transition-colors">
        {t.nav.faq}
      </a>
    </nav>
    
    <!-- Language Switcher + CTA (Desktop) -->
    <div class="hidden md:flex items-center gap-6">
      <LanguageSwitcher />
      <Button href="#pricing" variant="primary">
        {t.nav.tryFree}
      </Button>
    </div>
    
    <!-- Hamburger Menu (Mobile) -->
    <button 
      class="md:hidden hamburger" 
      id="hamburger" 
      aria-label="Toggle menu" 
      aria-expanded="false"
    >
      <span></span>
      <span></span>
      <span></span>
      <span></span>
    </button>
  </div>
</header>

<!-- Mobile Menu -->
<div class="mobile-menu" id="mobile-menu">
  <a href={homeHref} class="text-xl font-medium text-white mb-6">
    {t.nav.home}
  </a>
  <a href="#features" class="text-xl font-medium text-white mb-6">
    {t.nav.features}
  </a>
  <a href="#channels" class="text-xl font-medium text-white mb-6">
    {t.nav.channels}
  </a>
  <a href="#integrations" class="text-xl font-medium text-white mb-6">
    {t.nav.integrations}
  </a>
  <a href="#pricing" class="text-xl font-medium text-white mb-6">
    {t.nav.pricing}
  </a>
  <a href="#faq" class="text-xl font-medium text-white mb-6">
    {t.nav.faq}
  </a>
  
  <Button href="#pricing" variant="primary" class="mt-4 w-full">
    {t.nav.tryFree}
  </Button>

  <!-- Language Switcher (Mobile) -->
  <div class="mt-6">
    <LanguageSwitcher />
  </div>
</div>

<!-- Overlay -->
<div class="overlay" id="overlay"></div>

<script>
  // Hamburger menu toggle functionality
  document.addEventListener('DOMContentLoaded', () => {
    const hamburger = document.getElementById('hamburger');
    const mobileMenu = document.getElementById('mobile-menu');
    const overlay = document.getElementById('overlay');
    
    if (!hamburger || !mobileMenu || !overlay) {
      console.warn('Mobile menu elements not found');
      return;
    }
    
    // Toggle menu function
    const toggleMenu = () => {
      const isActive = hamburger.classList.contains('active');
      
      hamburger.classList.toggle('active');
      mobileMenu.classList.toggle('active');
      overlay.classList.toggle('active');
      
      // Update aria-expanded attribute
      hamburger.setAttribute('aria-expanded', (!isActive).toString());
      
      // Prevent body scroll when menu is open
      if (!isActive) {
        document.body.style.overflow = 'hidden';
      } else {
        document.body.style.overflow = '';
      }
    };
    
    // Hamburger click event
    hamburger.addEventListener('click', (e) => {
      e.stopPropagation();
      toggleMenu();
    });
    
    // Overlay click event
    overlay.addEventListener('click', toggleMenu);
    
    // Close menu when clicking on menu links
    const menuLinks = mobileMenu.querySelectorAll('a');
    menuLinks.forEach(link => {
      link.addEventListener('click', () => {
        if (mobileMenu.classList.contains('active')) {
          toggleMenu();
        }
      });
    });
    
    // Close menu on Escape key
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && mobileMenu.classList.contains('active')) {
        toggleMenu();
      }
    });
  });
</script>
